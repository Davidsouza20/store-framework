"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.showReports = void 0;
const tslib_1 = require("tslib");
const ora_1 = tslib_1.__importDefault(require("ora"));
const chalk_1 = tslib_1.__importDefault(require("chalk"));
const Lighthouse_1 = require("../client/Lighthouse");
const vtex_1 = require("vtex");
const TableGenerator_1 = require("./TableGenerator");
function allWhenUndefined(atribute) {
    return atribute !== null && atribute !== void 0 ? atribute : '<all>';
}
function appUrlFormatString(app, url) {
    return `${chalk_1.default.green(allWhenUndefined(app))} and url: ${chalk_1.default.blue(allWhenUndefined(url))}`;
}
async function showReports(app, url) {
    if (!app && !url) {
        vtex_1.logger.error('You must specify app or url flags to query reports');
        return;
    }
    const spinner = ora_1.default(`Querying reports containing app: ${appUrlFormatString(app, url)}`).start();
    try {
        const lighthouse = Lighthouse_1.Lighthouse.createClient();
        const reports = await lighthouse.getReports(app, url);
        spinner.stop();
        if (reports.length === 0) {
            vtex_1.logger.info(`No reports with app: ${appUrlFormatString(app, url)}`);
            return;
        }
        const table = new TableGenerator_1.TableGenerator();
        table.addListOfReports(reports);
        table.show();
    }
    catch (error) {
        spinner.stop();
        vtex_1.ErrorReport.createAndMaybeRegisterOnTelemetry({ originalError: error });
        vtex_1.logger.error(error);
    }
}
exports.showReports = showReports;
